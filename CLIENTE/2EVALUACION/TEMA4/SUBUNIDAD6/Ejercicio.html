<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ejercicio Alertas - Versión Completa</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .alert {
      margin-top: 20px;
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
    }

    .success { background: #28a745; }
    .error { background: #dc3545; }
    .warning { background: #ffc107; color: #000; }

    button {
      margin: 5px;
      padding: 6px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Ejercicio: Refactorización de Alertas</h1>

<button id="btnShowSuccess">Mostrar éxito</button>
<button id="btnActionSuccess">Acción éxito</button>

<br>

<button id="btnShowError">Mostrar error</button>
<button id="btnActionError">Acción error</button>

<br>

<button id="btnShowWarning">Mostrar aviso</button>
<button id="btnActionWarning">Acción aviso</button>

<div id="alerts"></div>

<script>
/* ==========================================================
   CLASE PADRE: AlertGeneric
   - Convertida a atributos privados
========================================================== */
class AlertGeneric {

  // ATRIBUTOS PRIVADOS
  #type;
  #message;
  #element;

  constructor(type, message) {
    this.#type = type;
    this.#message = message;

    this.#element = document.createElement("div");
    this.#element.className = `alert ${type}`;
  }

  // Getters (útiles para las hijas)
  get type() { return this.#type; }
  get message() { return this.#message; }
  get element() { return this.#element; }

  // Setter controlado para actualizar mensaje si hace falta
  set message(value) { this.#message = value; }

  render(container) {
    // Muestra el mensaje genérico
    this.#element.textContent = this.#type + ": " + this.#message;

    if (!this.#element.parentNode) {
      container.appendChild(this.#element);
    }
  }
}

/* ==========================================================
   CLASE HIJA: AlertSuccess
   - Hereda de AlertGeneric
   - Parámetro extra: tiempo (ms)
   - Método autoClose()
========================================================== */
class AlertSuccess extends AlertGeneric {

  #timeoutMs;
  #timerId;

  constructor(message, timeoutMs) {
    super("success", message);
    this.#timeoutMs = timeoutMs;
    this.#timerId = null;
  }

  render(container) {
    super.render(container);
  }

  autoClose() {
    // Si no está en el DOM, no hay nada que cerrar
    if (!this.element.parentNode) return;

    // Evitar múltiples temporizadores
    if (this.#timerId) clearTimeout(this.#timerId);

    this.#timerId = setTimeout(() => {
      if (this.element.parentNode) {
        this.element.remove();
      }
      this.#timerId = null;
    }, this.#timeoutMs);
  }
}

/* ==========================================================
   CLASE HIJA: AlertError
   - Hereda de AlertGeneric
   - Parámetro extra: texto de ayuda
   - Método showHelp()
========================================================== */
class AlertError extends AlertGeneric {

  #helpText;

  constructor(message, helpText) {
    super("error", message);
    this.#helpText = helpText;
  }

  render(container) {
    super.render(container);
  }

  showHelp() {
    // Puedes cambiar esto por console.log si lo prefieres
    alert("Ayuda: " + this.#helpText);
  }
}

/* ==========================================================
   CLASE HIJA: AlertWarning
   - Hereda de AlertGeneric
   - Contador privado
   - Método highlight(): incrementa y actualiza texto
========================================================== */
class AlertWarning extends AlertGeneric {

  #count;

  constructor(message) {
    super("warning", message);
    this.#count = 0;
  }

  render(container) {
    // Mostrar contador junto al mensaje
    this.element.textContent = `${this.type}: ${this.message} (contador: ${this.#count})`;

    if (!this.element.parentNode) {
      container.appendChild(this.element);
    }
  }

  highlight() {
    this.#count++;

    // Si aún no se ha mostrado, la mostramos
    const container = document.getElementById("alerts");
    if (!this.element.parentNode) {
      this.render(container);
      return;
    }

    // Actualiza el texto ya visible
    this.element.textContent = `${this.type}: ${this.message} (contador: ${this.#count})`;
  }
}

const container = document.getElementById("alerts");

// ESTAS INSTANCIAS FUNCIONAN
const success = new AlertSuccess("Operación completada", 2000);
const error   = new AlertError("Error al guardar", "Comprueba tu conexión");
const warning = new AlertWarning("Faltan datos obligatorios");

document.getElementById("btnShowSuccess").onclick = () =>
  success.render(container);

document.getElementById("btnActionSuccess").onclick = () =>
  success.autoClose();

document.getElementById("btnShowError").onclick = () =>
  error.render(container);

document.getElementById("btnActionError").onclick = () =>
  error.showHelp();

document.getElementById("btnShowWarning").onclick = () =>
  warning.render(container);

document.getElementById("btnActionWarning").onclick = () =>
  warning.highlight();
</script>

</body>
</html>
