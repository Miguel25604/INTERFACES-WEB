# Reporte de proyecto

## Estructura del proyecto

```
C:\Users\MiguelGavilaIbanez-A\Desktop\INTERFACES-WEB\PROYECTO
├── FRONT_SNIPPET.html
├── actualiza.php
├── admin.php
├── api.php
├── config.php
├── img1.jfif
├── img2.jfif
├── img3.jfif
├── img4.jfif
├── img5.jfif
├── img6.jfif
├── portafolio.php
├── portfolio.db
└── uploads
    ├── img_690b9772dbafb9.35435631.jfif
    ├── img_690b97971dd4c3.97353199.jfif
    └── img_690b99344d8220.94231516.jfif
```

## Código (intercalado)

# PROYECTO
**FRONT_SNIPPET.html**
```html
<!-- Sustituye tu galería estática por esta dinámica -->
<h2>Galería dinámica (desde SQLite via PHP)</h2>
<section id="galeria"></section>

<script>
async function cargarPortafolio(){
  try{
    const res = await fetch('api.php');
    const data = await res.json();
    const gal = document.querySelector('#galeria');
    gal.style.display='grid';
    gal.style.gridTemplateColumns='repeat(6, 1fr)';
    gal.style.gap='20px';
    gal.innerHTML = '';
    (data.items || []).forEach(item => {
      const img = document.createElement('img');
      img.src = item.image_url || 'img-placeholder.png';
      img.alt = item.title + (item.description ? (' — ' + item.description) : '');
      img.style.width='100%';
      img.style.height='180px';
      img.style.objectFit='cover';
      img.style.border='1px solid white';
      img.style.borderRadius='5px';
      img.style.cursor='pointer';
      img.addEventListener('click', () => abrirModalDesde(img, gal.querySelectorAll('img')));
      gal.appendChild(img);
    });
  }catch(e){
    console.error(e);
  }
}
cargarPortafolio();
</script>

```
**actualiza.php**
```php
<?php
// === actualiza.php ===
// Actualiza un campo de un registro (llamado por fetch desde admin.php)
require_once __DIR__ . '/config.php';
header('Content-Type: application/json; charset=utf-8');
try {
  $id = intval($_GET['identificador'] ?? 0);
  $col = $_GET['columna'] ?? '';
  $val = $_GET['contenido'] ?? '';
  $permitidas = ['title','description','author','tags','image_path'];
  if ($id <= 0) throw new Exception('ID inválido');
  if (!in_array($col, $permitidas, true)) throw new Exception('Columna no permitida');

  $db = db();
  $stmt = $db->prepare("UPDATE portfolio_items SET $col = :val WHERE id = :id");
  $stmt->bindValue(':val', $val, SQLITE3_TEXT);
  $stmt->bindValue(':id', $id, SQLITE3_INTEGER);
  $stmt->execute();
  echo json_encode(['ok'=>true]);
} catch (Exception $e) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>$e->getMessage()]);
}
?>
```
**admin.php**
```php
<?php
// === admin.php ===
// Panel CRUD para el portafolio (SQLite + PHP)
// Requiere: config.php, actualiza.php, portfolio.db y carpeta uploads/
require_once __DIR__ . '/config.php';

$err = null;
$msg = null;

// Alta de pieza (POST)
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
  try {
    $db = db();
    $title = trim($_POST['title'] ?? '');
    $description = trim($_POST['description'] ?? '');
    $author = trim($_POST['author'] ?? 'Miguel');
    $tags = trim($_POST['tags'] ?? '');

    if ($title === '') {
      throw new Exception('El título es obligatorio');
    }

    // Subida de imagen opcional
    $image_path = null;
    if (!empty($_FILES['image']['name'])) {
      ensure_uploads();
      if ($_FILES['image']['error'] !== UPLOAD_ERR_OK) {
        throw new Exception('Error al subir la imagen');
      }
      $ext = pathinfo($_FILES['image']['name'], PATHINFO_EXTENSION);
      $safe = uniqid('img_', true) . ($ext ? ('.' . preg_replace('/[^a-zA-Z0-9]/', '', $ext)) : '');
      $dest = __DIR__ . '/uploads/' . $safe;
      if (!move_uploaded_file($_FILES['image']['tmp_name'], $dest)) {
        throw new Exception('No se pudo mover el archivo subido');
      }
      $image_path = 'uploads/' . $safe;
    }

    $stmt = $db->prepare('INSERT INTO portfolio_items (title, description, image_path, author, tags) VALUES (?,?,?,?,?)');
    $stmt->bindValue(1, $title, SQLITE3_TEXT);
    $stmt->bindValue(2, $description, SQLITE3_TEXT);
    $stmt->bindValue(3, $image_path, SQLITE3_TEXT);
    $stmt->bindValue(4, $author, SQLITE3_TEXT);
    $stmt->bindValue(5, $tags, SQLITE3_TEXT);
    $stmt->execute();

    $msg = 'Pieza creada correctamente';
  } catch (Exception $e) {
    $err = $e->getMessage();
  }
}

// Eliminación (?delete=ID)
if (isset($_GET['delete']) && $_GET['delete'] !== '') {
  try {
    $id = (int)$_GET['delete'];
    $db = db();

    // Borrar también el fichero si es local
    $sel = $db->prepare('SELECT image_path FROM portfolio_items WHERE id = ?');
    $sel->bindValue(1, $id, SQLITE3_INTEGER);
    $row = $sel->execute()->fetchArray(SQLITE3_ASSOC);
    if ($row && $row['image_path'] && !preg_match('#^https?://#', $row['image_path'])) {
      $path = __DIR__ . '/' . $row['image_path'];
      if (is_file($path)) @unlink($path);
    }

    $del = $db->prepare('DELETE FROM portfolio_items WHERE id = ?');
    $del->bindValue(1, $id, SQLITE3_INTEGER);
    $del->execute();

    header('Location: admin.php?msg=deleted');
    exit;
  } catch (Exception $e) {
    $err = $e->getMessage();
  }
}
?>
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Panel Portafolio</title>
  <style>
    body{display:flex;gap:30px;align-items:flex-start;justify-content:center;padding:30px;background:aliceblue;font-family:sans-serif;font-size:14px;}
    table{padding:20px;background:white;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,0.2);flex:3;border-collapse:collapse;min-width:780px;}
    th,td{border-bottom:1px solid #eee;padding:8px 10px;vertical-align:top;}
    th{background:#fafafa;text-align:left;}
    form.card{flex:1;display:flex;flex-direction:column;gap:10px;padding:20px;background:white;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,0.2);}
    input[type=text], textarea{padding:8px;border:1px solid #ccc;border-radius:6px;width:100%;}
    .msg{padding:8px 12px;border-radius:6px;margin-bottom:10px;}
    .ok{background:#e8fff1;border:1px solid #b6efc7;}
    .err{background:#ffecec;border:1px solid #ffb3b3;}
    img.thumb{width:80px;height:60px;object-fit:cover;border:1px solid #ccc;border-radius:6px;background:#eee;}
    a.btn-del{color:#b00;text-decoration:none;}
    small.hint{color:#666}
  </style>
</head>
<body>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Miniatura</th>
        <th>Título</th>
        <th>Descripción</th>
        <th>Autor</th>
        <th>Tags</th>
        <th>Fecha</th>
        <th>Eliminar</th>
      </tr>
    </thead>
    <tbody>
      <?php
        try {
          $db = db();
          $res = $db->query('SELECT id,title,description,image_path,author,tags,created_at FROM portfolio_items ORDER BY datetime(created_at) DESC, id DESC');
          while ($fila = $res->fetchArray(SQLITE3_ASSOC)) {
            $src = $fila['image_path'];
            if ($src && !preg_match('#^https?://#', $src)) { $src = $src; }
            echo '<tr>';
            echo '<td>'.(int)$fila['id'].'</td>';
            echo '<td>'.($src ? "<img class='thumb' src='".htmlspecialchars($src,ENT_QUOTES)."' alt=''>" : "<small class='hint'>(sin imagen)</small>").'</td>';
            echo '<td identificador="'.(int)$fila['id'].'" columna="title">'.htmlspecialchars($fila['title']).'</td>';
            echo '<td identificador="'.(int)$fila['id'].'" columna="description">'.htmlspecialchars($fila['description']).'</td>';
            echo '<td identificador="'.(int)$fila['id'].'" columna="author">'.htmlspecialchars($fila['author']).'</td>';
            echo '<td identificador="'.(int)$fila['id'].'" columna="tags">'.htmlspecialchars($fila['tags']).'</td>';
            echo '<td>'.htmlspecialchars($fila['created_at']).'</td>';
            echo '<td><a class="btn-del" href="?delete='.(int)$fila['id'].'" onclick="return confirm(\'¿Eliminar?\');">❌</a></td>';
            echo '</tr>';
          }
        } catch (Exception $e) {
          echo '<tr><td colspan="8"><div class="msg err">'.htmlspecialchars($e->getMessage()).'</div></td></tr>';
        }
      ?>
    </tbody>
  </table>

  <form class="card" action="admin.php" method="POST" enctype="multipart/form-data">
    <h3>Nueva pieza</h3>
    <?php if (isset($_GET['msg']) && $_GET['msg']==='deleted'): ?>
      <div class="msg ok">Pieza eliminada</div>
    <?php endif; ?>
    <?php if ($msg): ?>
      <div class="msg ok"><?php echo htmlspecialchars($msg); ?></div>
    <?php endif; ?>
    <?php if ($err): ?>
      <div class="msg err"><?php echo htmlspecialchars($err); ?></div>
    <?php endif; ?>

    <label>Título
      <input type="text" name="title" required>
    </label>
    <label>Descripción
      <textarea name="description" rows="4"></textarea>
    </label>
    <label>Autor
      <input type="text" name="author" value="Miguel">
    </label>
    <label>Tags (coma separadas)
      <input type="text" name="tags" placeholder="web, ui, print">
    </label>
    <label>Imagen (JPG/PNG)
      <input type="file" name="image" accept="image/*">
    </label>
    <button type="submit">Guardar</button>
    <small class="hint">Doble clic en las celdas para editar. Al salir, se guarda.</small>
  </form>

  <!-- A partir de aquí ya NO hay PHP. El JS está fuera para evitar que PHP lo interprete -->
  <script>
    // Edición inline con fetch a actualiza.php
    const celdas = document.querySelectorAll('td[columna]');
    celdas.forEach(function(celda){
      celda.ondblclick = function(){
        this.setAttribute('contenteditable', 'true');
        this.focus();
      };
      celda.onblur = function(){
        this.setAttribute('contenteditable', 'false');
        const contenido = this.textContent.trim();
        const columna = this.getAttribute('columna');
        const identificador = this.getAttribute('identificador');
        fetch('actualiza.php?identificador=' + encodeURIComponent(identificador) +
              '&columna=' + encodeURIComponent(columna) +
              '&contenido=' + encodeURIComponent(contenido))
          .then(r => r.json())
          .then(d => {
            if (!d.ok) { alert('Error: ' + d.error); }
          })
          .catch(() => alert('Error de red'));
      };
    });
  </script>
</body>
</html>


```
**api.php**
```php
<?php
// === api.php ===
header('Content-Type: application/json; charset=utf-8');
require_once __DIR__ . '/config.php';

try {
  $db = db();
  $res = $db->query('SELECT id, title, description, image_path, author, tags, created_at FROM portfolio_items ORDER BY datetime(created_at) DESC, id DESC');
  $items = [];
  while ($row = $res->fetchArray(SQLITE3_ASSOC)) {
    // Exponer image_url amigable si es ruta relativa
    $row['image_url'] = (preg_match('#^https?://#', $row['image_path'])) ? $row['image_path'] : ('uploads/' . basename($row['image_path']));
    $items[] = $row;
  }
  echo json_encode(['ok'=>true, 'items'=>$items], JSON_UNESCAPED_UNICODE);
} catch (Exception $e) {
  http_response_code(500);
  echo json_encode(['ok'=>false, 'error'=>$e->getMessage()]);
}
?>
```
**config.php**
```php
<?php
// === config.php ===
// Ruta al archivo SQLite. Coloca este proyecto en tu servidor PHP tal cual.
// Asegúrate de que el proceso de PHP tenga permisos de escritura sobre 'portfolio.db' y la carpeta 'uploads'.
$DB_FILE = __DIR__ . '/portfolio.db';

function db() {
  global $DB_FILE;
  $db = new SQLite3($DB_FILE);
  $db->enableExceptions(true);
  $db->exec('PRAGMA foreign_keys = ON;');
  return $db;
}

function ensure_uploads() {
  $dir = __DIR__ . '/uploads';
  if (!is_dir($dir)) { mkdir($dir, 0775, true); }
  return $dir;
}
?>
```
**portafolio.php**
```php
<!doctype html>
<html lang="es">
  <head>
    <title>Portafolio de Miguel</title>
    <meta charset="utf-8">
  </head>
  <body>
    <header>
      <h1>Portafolio de Miguel</h1>
      <p>Contacto:
        <a href="mailto:miguel.gavila@alu.ceacfp.es">miguel.gavila@alu.ceacfp.es</a> ·
        <a href="tel:+34900111222">+34 900 111 222</a>
      </p>
    </header>

    <main>
      <h2>Galería dinámica (desde SQLite via PHP)</h2>
<section id="galeria"></section>

<script>
async function cargarPortafolio(){
  try{
    const res = await fetch('api.php');
    const data = await res.json();
    const gal = document.querySelector('#galeria');
    gal.style.display='grid';
    gal.style.gridTemplateColumns='repeat(6, 1fr)';
    gal.style.gap='20px';
    gal.innerHTML = '';
    (data.items || []).forEach(item => {
      const img = document.createElement('img');
      img.src = item.image_url || 'img-placeholder.png';
      img.alt = item.title + (item.description ? (' — ' + item.description) : '');
      img.style.width='100%';
      img.style.height='180px';
      img.style.objectFit='cover';
      img.style.border='1px solid white';
      img.style.borderRadius='5px';
      img.style.cursor='pointer';
      img.addEventListener('click', () => abrirModalDesde(img, gal.querySelectorAll('img')));
      gal.appendChild(img);
    });
  }catch(e){
    console.error(e);
  }
}
cargarPortafolio();
</script>
    </main>

    <style>
      /* === HEADER === */
      header{
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: white;
        color:rgba(129, 9, 99, 0.877);
        padding:20px;
        text-align:center;
        box-shadow:0px 4px 10px rgba(0,0,0,0.4);
      }
      header h1{
        margin:0;
        font-size:28px;
        letter-spacing:1px;
      }
      header p{
        margin-top:8px;
        font-size:16px;
      }
      header a{
        color:rgba(129, 9, 99, 0.877);
        text-decoration:none;
      }
      header a:hover{
        text-decoration:underline;
      }

      /* === CUERPO === */
      body{
        background:rgb(165, 165, 165);
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        margin:0;
      }
      main{
        padding:10px 20px;
      }
      h2{
        font-size:18px;
        color:white;
      }

      /* === GRID === */
      #galeriaestatica{
        display:grid;
        grid-template-columns:auto auto auto auto auto auto auto auto;
        gap:20px;
        margin-bottom:20px;
      }
      #galeriaestatica img{
        width:100%;
        height:180px;
        object-fit:cover;
        transition:all 1s;
        border-radius:5px;
        border:1px solid white;
        cursor:pointer;
        background:#111;
      }
      #galeriaestatica img:hover{
        transform:scale(1.1,1.1);
      }

      /* === MODAL === */
      #contenedormodal{
        position:fixed;
        width:100%;
        height:100%;
        background:rgba(0,0,0,0.5);
        top:0;
        left:0;
        display:none;
        align-items:center;
        justify-content:center;
        backdrop-filter: blur(5px);
      }
      #modal{
        width:800px;
        height:520px;
        background:white;
        padding:20px;
        border-radius:5px;
        box-shadow:0px 10px 20px black;
        text-align:center;
        display:flex;
        justify-content:space-between;
        align-items:center;
        position:relative;
      }
      #modal button{
        border:none;
        background:white;
        box-shadow:0px 2px 4px black;
        border-radius:100px;
        width:38px;
        height:38px;
        font-size:18px;
        cursor:pointer;
      }
      #contienepieza{
        width:100%;
        height:100%;
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:center;
        gap:10px;
      }
      #contienepieza img{
        max-width:100%;
        max-height:85%;
        border-radius:6px;
      }
      #contienepieza p{
        margin:0;
        color:#333;
      }
      #cerrar{
        position:absolute;
        right:12px;
        top:12px;
        border:none;
        background:white;
        box-shadow:0px 2px 4px black;
        border-radius:100px;
        padding:6px 10px;
        font-size:14px;
        cursor:pointer;
      }

  
    </style>

    <!-- MODAL -->
    <div id="contenedormodal" tabindex="-1" aria-hidden="true">
      <div id="modal">
        <button id="anterior" title="Anterior">⬅</button>
        <div id="contienepieza">
          <img src="" alt="">
          <p id="pie"></p>
          <small id="contador" style="color:#666"></small>
        </div>
        <button id="siguiente" title="Siguiente">➡</button>
        <button id="cerrar" title="Cerrar">✖</button>
      </div>
    </div>

    <script>
      var imagen_activa = undefined;
      var lista_actual = [];

      // Abrir modal
      function abrirModalDesde(img, lista){
        imagen_activa = img;
        lista_actual = lista;
        document.querySelector("#contenedormodal").style.display = "flex";
        let origen = img.getAttribute("src");
        document.querySelector("#contienepieza img").setAttribute("src", origen);
        document.querySelector("#pie").textContent = img.getAttribute("alt") || "";
        actualizarContador();
      }

      function actualizarContador(){
        if(!lista_actual.length){ 
          document.querySelector("#contador").textContent = "";
          return;
        }
        var idx = Array.prototype.indexOf.call(lista_actual, imagen_activa);
        document.querySelector("#contador").textContent = (idx+1) + " / " + lista_actual.length;
      }

      // Galería estática
      function prepararEstatica(){
        let imgs = document.querySelectorAll("#galeriaestatica img");
        imgs.forEach(function(im){
          im.onclick = function(){ abrirModalDesde(this, imgs); }
        });
      }

      // Cerrar modal
      document.querySelector("#contenedormodal").onclick = function(e){
        if(e.target === this){ this.style.display = "none"; }
      }
      document.querySelector("#cerrar").onclick = function(e){
        e.stopPropagation();
        document.querySelector("#contenedormodal").style.display = "none";
      }

      // Navegación
      document.querySelector("#siguiente").onclick = function(event){
        if(!imagen_activa) return;
        var siguiente = imagen_activa.nextElementSibling;
        if(!siguiente){ siguiente = lista_actual[0]; }
        let origen = siguiente.getAttribute("src");
        document.querySelector("#contienepieza img").setAttribute("src", origen);
        document.querySelector("#pie").textContent = siguiente.getAttribute("alt") || "";
        imagen_activa = siguiente;
        actualizarContador();
        event.stopPropagation();
      }

      document.querySelector("#anterior").onclick = function(event){
        if(!imagen_activa) return;
        var anterior = imagen_activa.previousElementSibling;
        if(!anterior){ anterior = lista_actual[lista_actual.length - 1]; }
        let origen = anterior.getAttribute("src");
        document.querySelector("#contienepieza img").setAttribute("src", origen);
        document.querySelector("#pie").textContent = anterior.getAttribute("alt") || "";
        imagen_activa = anterior;
        actualizarContador();
        event.stopPropagation();
      }

      // Teclado
      window.addEventListener("keydown", function(e){
        var abierto = document.querySelector("#contenedormodal").style.display === "flex";
        if(!abierto) return;
        if(e.key === "Escape"){ document.querySelector("#contenedormodal").style.display = "none"; }
        if(e.key === "ArrowRight"){ document.querySelector("#siguiente").click(); }
        if(e.key === "ArrowLeft"){ document.querySelector("#anterior").click(); }
      });

      // Iniciar
      prepararEstatica();
    </script>
  </body>
</html>

```
## uploads